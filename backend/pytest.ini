[pytest]
# SmartPen Backend Test Configuration
# 符合 PRD v2.1 及 AI 辅助开发工作流标准

# 测试发现规则
testpaths = tests
python_files = test_*.py *_tests.py
python_classes = Test*
python_functions = test_*

# 核心命令行选项
addopts =
    -v
    # 覆盖率配置
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    # 质量门槛: 85% (低于此值 CI 失败)
    --cov-fail-under=85
    # 严格标记模式 (防止拼写错误)
    --strict-markers

# 异步测试配置 (针对 FastAPI)
asyncio_mode = auto

# 测试标记定义 (分类运行策略)
markers =
    unit: 纯逻辑单元测试 (快)
    integration: 数据库/API 集成测试 (中)
    slow: 耗时较长的测试
    requires_camera: 需要摄像头硬件的测试
    requires_inksight: 需要加载 TensorFlow/InkSight 模型的测试 (慢/重)
    requires_ocr: 需要 PaddleOCR 的测试

# 警告过滤器 (保持清洁但允许特定库的遗留问题)
filterwarnings =
    error
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # 忽略 TensorFlow/Pytorch 可能产生的特定警告
    ignore::UserWarning

# 日志配置 (调试用)
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 路径配置
pythonpath = .
minversion = 7.0
