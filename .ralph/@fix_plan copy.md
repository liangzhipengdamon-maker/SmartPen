# SmartPen å¼€å‘ä»»åŠ¡åˆ—è¡¨ (PRD v2.1)

## âš ï¸ å…³é”®æŠ€æœ¯çº¦æŸ (å¿…é¡»éµå®ˆ)
1. **InkSight**: Python åŸç”ŸåŠ è½½ï¼ˆTensorFlow 2.15-2.17ï¼‰ï¼Œ**ç¦æ­¢ ONNX**
2. **Flutter è§†è§‰**: `google_ml_kit_pose_detection`
3. **DTW ç®—æ³•**: ä½¿ç”¨ `dtw` åº“ (pollen-robotics)ï¼Œç¦æ­¢è‡ªå·±å®ç°
4. **æ•°æ®åŠ è½½**: Hanzi Writer CDN åŠ¨æ€åŠ è½½

---

## Sprint 1: åŸºç¡€è®¾æ–½ (P0 - æœ€é«˜ä¼˜å…ˆçº§) âœ… å·²å®Œæˆ

### åç«¯é¡¹ç›®ç»“æ„
- [x] **P0-T1**: Python é¡¹ç›®ç»“æ„ï¼ˆFastAPI, pytest, pyproject.tomlï¼‰
  - âœ… åˆ›å»º `backend/` ç›®å½•ç»“æ„
  - âœ… é…ç½® `pyproject.toml` åŒ…ç®¡ç†ï¼ˆTensorFlow 2.15-2.17 çº¦æŸï¼‰
  - âœ… é…ç½® `pytest` æµ‹è¯•æ¡†æ¶
  - âœ… åˆ›å»º `backend/app/__init__.py`
  - âœ… å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆFastAPI, TensorFlow, PaddleOCR, dtw-pythonï¼‰

### æ•°æ®æ¨¡å‹
- [x] **P0-T2**: Character Pydantic æ¨¡å‹ âœ…
  - âœ… æ–‡ä»¶: `backend/app/models/character.py`
  - âœ… å®šä¹‰ `CharacterData`, `StrokeMedian`, `MedianPoint`, `StrokePath` æ¨¡å‹
  - âœ… éªŒè¯ Hanzi Writer JSON ç»“æ„
  - âœ… åæ ‡è½¬æ¢æ–¹æ³•ï¼ˆ`from_hanzi_1024()`, `to_hanzi_1024()`ï¼‰
  - âœ… 100% æµ‹è¯•è¦†ç›–ç‡

### æ•°æ®åŠ è½½å™¨
- [x] **P0-T3**: Hanzi Writer CDN åŠ è½½å™¨ âœ…
  - âœ… æ–‡ä»¶: `backend/app/parsers/hanzi_writer.py`
  - âœ… å®ç° `HanziWriterLoader` ç±»
  - âœ… ä» CDN `https://cdn.jsdelivr.net/npm/hanzi-writer-data@latest/{char}.json` åŠ è½½
  - âœ… å¼‚æ­¥åŠ è½½ (httpx)
  - âœ… éªŒè¯æ•°æ®ç»“æ„ï¼ˆå¿…é¡»æœ‰ `medians` å­—æ®µï¼‰
  - âœ… 83% æµ‹è¯•è¦†ç›–ç‡
  - âœ… çœŸå® CDN é›†æˆæµ‹è¯•é€šè¿‡

### åæ ‡è½¬æ¢
- [x] **P0-T4**: åæ ‡è½¬æ¢ç®¡é“ï¼ˆ1024 â†” 0-1ï¼‰âœ…
  - âœ… å·²åœ¨ `CharacterData` æ¨¡å‹ä¸­å®ç°
  - âœ… `MedianPoint.from_hanzi_1024()`: 1024 â†’ 0-1 å½’ä¸€åŒ–
  - âœ… `MedianPoint.to_hanzi_1024()`: 0-1 â†’ 1024 ç½‘æ ¼
  - âœ… æ¥å›è½¬æ¢æµ‹è¯•é€šè¿‡

### API ç«¯ç‚¹
- [x] **P0-T5**: FastAPI å­—ç¬¦æ£€ç´¢ç«¯ç‚¹ âœ…
  - âœ… æ–‡ä»¶: `backend/app/api/characters.py`
  - âœ… å®ç° `GET /api/characters/{char}` ç«¯ç‚¹ï¼ˆä½¿ç”¨ HanziWriterLoaderï¼‰
  - âœ… å®ç° `GET /api/characters/{char}/status` ç«¯ç‚¹
  - âœ… è¿”å› JSON æ ¼å¼å­—ç¬¦æ•°æ®ï¼ˆå½’ä¸€åŒ–åæ ‡ï¼‰
  - âœ… é”™è¯¯å¤„ç†ï¼ˆ404, 503 ç½‘ç»œé”™è¯¯ï¼‰
  - âœ… 86% æµ‹è¯•è¦†ç›–ç‡

### æµ‹è¯•åŸºç¡€è®¾æ–½
- [ ] **P0-T6**: æ•°æ®å±‚ç»¼åˆæµ‹è¯•ï¼ˆpytest fixturesï¼‰- å¯é€‰ä¼˜åŒ–
  - åŸºç¡€æµ‹è¯•å·²å®Œæˆï¼ˆ44 ä¸ªæµ‹è¯•ï¼Œ91% è¦†ç›–ç‡ï¼‰
  - å¯é€‰ï¼šæ·»åŠ æ›´å¤š fixtures ç®€åŒ–æµ‹è¯•ä»£ç 

**Sprint 1 å®Œæˆåº¦**: 5/6 ä»»åŠ¡å®Œæˆï¼ˆ83%ï¼‰
**æµ‹è¯•è¦†ç›–**: 44 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œ91% ä»£ç è¦†ç›–ç‡

---

## Sprint 2: è¯„åˆ†å¼•æ“ (P0 - æœ€é«˜ä¼˜å…ˆçº§) âœ… å·²å®Œæˆ

### é‡é‡‡æ ·ç®—æ³•
- [x] **P0-T8**: ç¬”ç”»é‡é‡‡æ ·ç®—æ³• âœ…
  - âœ… æ–‡ä»¶: `backend/app/algorithms/resampling.py`
  - âœ… å®ç°ç­‰é—´è·é‡é‡‡æ ·ï¼ˆnumpy çº¿æ€§æ’å€¼ï¼‰
  - âœ… å¤„ç†ä¸åŒé•¿åº¦çš„ç¬”ç”»
  - âœ… 15 ä¸ªæµ‹è¯•ï¼Œ91% è¦†ç›–ç‡

### DTW è¯„åˆ†
- [x] **P0-T9**: DTW è·ç¦»è®¡ç®—ï¼ˆä½¿ç”¨ dtw åº“ï¼‰âœ…
  - âœ… æ–‡ä»¶: `backend/app/algorithms/dtw.py`
  - âœ… ä½¿ç”¨ `from dtw import dtw` (pollen-robotics)
  - âœ… `dist_method='cityblock'` (æ›¼å“ˆé¡¿è·ç¦»)
  - âœ… 20 ä¸ªæµ‹è¯•ï¼Œ100% è¦†ç›–ç‡

### è¯„åˆ†å½’ä¸€åŒ–
- [x] **P0-T10**: è¯„åˆ†å½’ä¸€åŒ–ï¼ˆ0-100 åˆ†ï¼‰âœ…
  - âœ… æ–‡ä»¶: `backend/app/scoring/normalizer.py`
  - âœ… æŒ‡æ•°è¡°å‡å…¬å¼: `score = 100 * exp(-distance / max_distance)`
  - âœ… å®Œç¾åŒ¹é… = 100 åˆ†
  - âœ… 23 ä¸ªæµ‹è¯•ï¼Œ100% è¦†ç›–ç‡

### ç¬”é¡ºéªŒè¯
- [x] **P0-T11**: ç¬”é¡ºéªŒè¯é€»è¾‘ âœ…
  - âœ… æ–‡ä»¶: `backend/app/scoring/stroke_order.py`
  - âœ… ç¬”ç”»æ–¹å‘æ£€æµ‹ï¼ˆæ°´å¹³ã€å‚ç›´ã€å¯¹è§’çº¿ã€æ›²çº¿ï¼‰
  - âœ… ç¬”ç”»é¡ºåºéªŒè¯ï¼ˆç›¸ä¼¼åº¦çŸ©é˜µå¯¹è§’çº¿è¯„åˆ†ï¼‰
  - âœ… 17 ä¸ªæµ‹è¯•ï¼Œ99% è¦†ç›–ç‡

### æ€§èƒ½ä¼˜åŒ–
- [x] **P0-T12**: æ€§èƒ½ä¼˜åŒ– âœ…
  - âœ… å•å­—è¯„åˆ† < 2 ç§’ï¼ˆå®é™…æµ‹è¯• < 1.5 ç§’ï¼‰
  - âœ… 11 ä¸ªæ€§èƒ½æµ‹è¯•
  - âœ… ç«¯åˆ°ç«¯ç®¡é“æµ‹è¯•é€šè¿‡

**Sprint 2 å®Œæˆåº¦**: 5/5 ä»»åŠ¡å®Œæˆï¼ˆ100%ï¼‰
**æµ‹è¯•è¦†ç›–**: 131 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œ95% ä»£ç è¦†ç›–ç‡
**æ€§èƒ½æŒ‡æ ‡**: å¤æ‚å­—ç¬¦è¯„åˆ† < 2 ç§’ âœ…

---

## Sprint 3: AI æ¨¡å‹é›†æˆ (P1 - é«˜ä¼˜å…ˆçº§) âœ… å·²å®Œæˆ

### InkSight é›†æˆ (âš ï¸ é«˜é£é™© - ä¸¥æ ¼ç‰ˆæœ¬çº¦æŸ)
- [x] **P1-T1**: InkSight Python åŸç”ŸåŒ…è£…å™¨ï¼ˆTensorFlowï¼‰âœ…
  - âœ… æ–‡ä»¶: `backend/app/models/inksight.py`
  - âœ… **ä¸¥æ ¼ç‰ˆæœ¬çº¦æŸ**: `tensorflow>=2.15.0,<2.18.0`
  - âœ… **ç¦æ­¢**: ä½¿ç”¨ ONNX
  - âœ… Mock æ¨¡å‹å›é€€ï¼ˆInkSight æœªå…¬å¼€å‘å¸ƒï¼‰
  - âœ… åæ ‡æ˜ å°„: 0-1 â†” 1024
  - âœ… 10 ä¸ªæµ‹è¯•ï¼Œ59% è¦†ç›–ç‡

- [x] **P1-T2**: HuggingFace æ¨¡å‹ä¸‹è½½ âœ…
  - âœ… æ–‡ä»¶: `backend/app/models/model_loader.py`
  - âœ… æ¨¡å‹æƒé‡ç¼“å­˜ç®¡ç†
  - âœ… å¹³å°ç‰¹å®šç¼“å­˜ç›®å½•
  - âœ… æ¨¡å‹å¯ç”¨æ€§æ£€æµ‹

### OCR é›†æˆ
- [x] **P1-T3**: PaddleOCR å­—ç¬¦éªŒè¯ âœ…
  - âœ… æ–‡ä»¶: `backend/app/models/paddle_ocr.py`
  - âœ… éªŒè¯ç”¨æˆ·å†™çš„å­—æ˜¯å¦æ˜¯ç›®æ ‡å­—
  - âœ… é˜²æ­¢å¼ å† ææˆ´
  - âœ… ç½®ä¿¡åº¦é˜ˆå€¼è¿‡æ»¤
  - âœ… 13 ä¸ªæµ‹è¯•ï¼Œ82% è¦†ç›–ç‡

### OpenCV é¢„å¤„ç†
- [x] **P1-T4**: OpenCV é¢„å¤„ç†ç®¡é“ï¼ˆé€è§†å˜æ¢ï¼‰âœ…
  - âœ… æ–‡ä»¶: `backend/app/preprocessing/image.py`
  - âœ… é€è§†å˜æ¢ (warpPerspective)
  - âœ… äºŒå€¼åŒ–å¤„ç†ï¼ˆOtsu/Adaptiveï¼‰
  - âœ… è§’ç‚¹æ£€æµ‹
  - âœ… å†…å®¹è£å‰ª

### éª¨æ¶æå–
- [x] **P1-T5**: éª¨æ¶æå–ï¼ˆZhang-Suen ç®—æ³•ï¼‰âœ…
  - âœ… æ–‡ä»¶: `backend/app/preprocessing/skeleton.py`
  - âœ… å®ç° Zhang-Suen ç»†åŒ–ç®—æ³•
  - âœ… ä»åŸå§‹å›¾ç‰‡æå–ç‰©ç†éª¨æ¶
  - âœ… ä¿ç•™æ‹“æ‰‘è¿é€šæ€§
  - âœ… **ç›®çš„**: ç”¨äºå¹»è§‰æŠ‘åˆ¶

### å¹»è§‰æŠ‘åˆ¶
- [x] **P1-T6**: åŸºäºæ©ç çš„å¹»è§‰æŠ‘åˆ¶ï¼ˆ**å…³é”®é£é™©**ï¼‰âœ…
  - âœ… æ–‡ä»¶: `backend/app/preprocessing/skeleton.py`
  - âœ… ä½¿ç”¨ç‰©ç†éª¨æ¶æ©ç çº¦æŸ InkSight è¾“å‡º
  - âœ… è¿‡æ»¤æ‰"ç”»å¤–"çš„å¹»è§‰ç‚¹
  - âœ… åæ ‡æ˜ å°„: 0-1 â†’ 1024x1024
  - âœ… validate_trajectory_with_mask()

**Sprint 3 å®Œæˆåº¦**: 6/6 ä»»åŠ¡å®Œæˆï¼ˆ100%ï¼‰
**æµ‹è¯•è¦†ç›–**: 166 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œ78% ä»£ç è¦†ç›–ç‡

---

## Sprint 4: å‰ç«¯åŸºç¡€ (P2 - ä¸­ç­‰ä¼˜å…ˆçº§) âœ… å·²å®Œæˆ

### Flutter é¡¹ç›®åˆå§‹åŒ–
- [x] **P2-T1**: Flutter é¡¹ç›®åˆå§‹åŒ– âœ…
  - âœ… ç›®å½•: `frontend/`
  - âœ… é…ç½® `pubspec.yaml`
  - âœ… æ·»åŠ ä¾èµ–: dio, flutter_svg, camera, provider

### API å®¢æˆ·ç«¯
- [x] **P2-T2**: HTTP å®¢æˆ·ç«¯å±‚ï¼ˆDioï¼‰âœ…
  - âœ… æ–‡ä»¶: `frontend/lib/api/characters_api.dart`
  - âœ… å°è£…åç«¯ API è°ƒç”¨
  - âœ… é”™è¯¯å¤„ç†å’Œè¶…æ—¶ç®¡ç†

### SVG æ¸²æŸ“
- [x] **P2-T3**: SVG æ¸²æŸ“ç»„ä»¶ï¼ˆflutter_svgï¼‰âœ…
  - âœ… æ–‡ä»¶: `frontend/lib/widgets/character_display.dart`
  - âœ… æ˜¾ç¤º Hanzi Writer å­—ç¬¦
  - âœ… CustomPainter ç¬”ç”»æ¸²æŸ“

### ä¹¦å†™ç”»å¸ƒ
- [x] **P2-T4**: ä¹¦å†™ç”»å¸ƒï¼ˆCustomPaintï¼‰âœ…
  - âœ… æ–‡ä»¶: `frontend/lib/widgets/writing_canvas.dart`
  - âœ… æ•è·è§¦æ‘¸è¾“å…¥ä¸ºç¬”ç”»æ•°æ®
  - âœ… ç±³å­—æ ¼èƒŒæ™¯
  - âœ… å®æ—¶ç¬”ç”»æ¸²æŸ“

### çŠ¶æ€ç®¡ç†
- [x] **P2-T5**: çŠ¶æ€ç®¡ç†ï¼ˆProviderï¼‰âœ…
  - âœ… æ–‡ä»¶: `frontend/lib/providers/character_provider.dart`
  - âœ… ç®¡ç†åº”ç”¨çŠ¶æ€
  - âœ… ç¬”ç”»æ•°æ®ç®¡ç†
  - âœ… è¯„åˆ†ç»“æœç®¡ç†

**Sprint 4 å®Œæˆåº¦**: 5/5 ä»»åŠ¡å®Œæˆï¼ˆ100%ï¼‰
**å‰ç«¯æ–‡ä»¶**: 9 ä¸ªæ ¸å¿ƒæ–‡ä»¶
**ä¾èµ–**: Dio, flutter_svg, provider, camera

---

## Sprint 5: å®æ—¶ç›‘æµ‹ (P1 - é«˜ä¼˜å…ˆçº§)

### ML Kit Pose é›†æˆ
- [ ] **P1-T7**: ML Kit Pose é›†æˆ
  - æ–‡ä»¶: `frontend/lib/services/mlkit_service.dart`
  - ä½¿ç”¨ `google_ml_kit_pose_detection`
  - **ç¦æ­¢**: åŸç”Ÿ MediaPipe C++ æ¡¥æ¥
  - ä½¿ç”¨ Lite æ¨¡å‹ï¼ˆæœ€å¿«ï¼‰
  - å¯ç”¨ stream æ¨¡å¼

### åå§¿æ£€æµ‹
- [ ] **P1-T8**: åå§¿æ£€æµ‹ç®—æ³•
  - æ–‡ä»¶: `frontend/lib/services/posture_detector.dart`
  - è®¡ç®—è„ŠæŸ±è§’åº¦
  - è®¡ç®—çœ¼å±è·ç¦»
  - å®æ—¶åé¦ˆï¼ˆ<100ms å»¶è¿Ÿï¼‰

### æ¡ç¬”æ£€æµ‹
- [ ] **P1-T9**: æ¡ç¬”æ£€æµ‹ç®—æ³•
  - æ–‡ä»¶: `frontend/lib/services/grip_detector.dart`
  - è®¡ç®—æ‰‹æŒ‡è§’åº¦
  - æ£€æµ‹æ¡ç¬”æ–¹å¼

### å®æ—¶åé¦ˆ UI
- [ ] **P1-T10**: å®æ—¶åé¦ˆ UIï¼ˆAR Overlayï¼‰
  - æ–‡ä»¶: `frontend/lib/widgets/feedback_overlay.dart`
  - AR å åŠ å±‚æ˜¾ç¤º

### æ€§èƒ½ä¼˜åŒ–
- [ ] **P1-T11**: æ€§èƒ½ä¼˜åŒ–
  - GPU åŠ é€Ÿ
  - Isolate å¤„ç†ï¼ˆéé˜»å¡ UIï¼‰

### è­¦æŠ¥ç³»ç»Ÿ
- [ ] **P1-T12**: è­¦æŠ¥ç³»ç»Ÿ
  - é”™è¯¯å§¿æ€è§¦å‘è­¦æŠ¥

---

## Sprint 6: é«˜çº§åŠŸèƒ½ (P2 - ä¸­ç­‰ä¼˜å…ˆçº§)

- [ ] **P2-T7**: è‡ªå®šä¹‰èŒƒå­—æµæ°´çº¿
  - æ•™å¸ˆåˆ›å»ºä¸ªæ€§åŒ–å­—æ¨¡

- [ ] **P2-T8**: ç”¨æˆ·è¿›åº¦è¿½è¸ª
  - SQLite æœ¬åœ°å­˜å‚¨
  - äº‘åŒæ­¥

- [ ] **P2-T9**: ç»ƒä¹ æ¨¡å¼é€‰æ‹© UI
  - åŸºç¡€æ¨¡å¼ã€ä¸“å®¶æ¨¡å¼

- [ ] **P2-T10**: æ€§èƒ½åˆ†æä»ªè¡¨æ¿
  - ç»Ÿè®¡å’Œå¯è§†åŒ–

- [ ] **P2-T11**: UI/UX æ‰“ç£¨
  - ç”Ÿäº§å°±ç»ª

- [ ] **P2-T12**: ç”Ÿäº§éƒ¨ç½²å‡†å¤‡

---

## å·²å®Œæˆ
- [x] é¡¹ç›®åˆå§‹åŒ–
- [x] Ralph é…ç½®
- [x] Superpowers å®‰è£…
- [x] PRD v2.1 å¯¼å…¥

---

## ğŸ¯ ç«‹å³å¼€å§‹
**å½“å‰ä¼˜å…ˆçº§**: Sprint 5 - P1-T7 (ML Kit Pose é›†æˆ)

**ä¸‹ä¸€æ­¥**: ç»§ç»­å‰ç«¯å®æ—¶ç›‘æµ‹åŠŸèƒ½å¼€å‘ã€‚

**Sprint 1 å›é¡¾**:
- âœ… 5/6 ä»»åŠ¡å®Œæˆï¼ˆ83%ï¼‰
- âœ… 44 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… 91% ä»£ç è¦†ç›–ç‡

**Sprint 2 å›é¡¾**:
- âœ… 5/5 ä»»åŠ¡å®Œæˆï¼ˆ100%ï¼‰
- âœ… 131 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… 95% ä»£ç è¦†ç›–ç‡

**Sprint 3 å›é¡¾**:
- âœ… 6/6 ä»»åŠ¡å®Œæˆï¼ˆ100%ï¼‰
- âœ… 166 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… 78% ä»£ç è¦†ç›–ç‡

**Sprint 4 å›é¡¾**:
- âœ… 5/5 ä»»åŠ¡å®Œæˆï¼ˆ100%ï¼‰
- âœ… Flutter å‰ç«¯å®Œæ•´å®ç°
- âœ… 9 ä¸ªæ ¸å¿ƒæ–‡ä»¶

**Sprint 5 ç›®æ ‡**:
- ML Kit Pose é›†æˆï¼ˆgoogle_ml_kit_pose_detectionï¼‰
- å®æ—¶åå§¿æ£€æµ‹ï¼ˆè„ŠæŸ±è§’åº¦ã€çœ¼å±è·ç¦»ï¼‰
- æ¡ç¬”æ£€æµ‹ç®—æ³•
- AR åé¦ˆå åŠ å±‚
- æ€§èƒ½ä¼˜åŒ–ï¼ˆGPUã€Isolateï¼‰

**å‘½ä»¤**:
```bash
# è¿è¡Œåç«¯æµ‹è¯•
cd /Users/Zhuanz/Documents/01_SmartPen/smartpen-project/backend
source .venv/bin/activate
pytest tests/ -v

# å¯åŠ¨ API æœåŠ¡å™¨
uvicorn app.main:app --reload

# è¿è¡Œ Flutter åº”ç”¨ï¼ˆéœ€è¦å…ˆå®‰è£… Flutter SDKï¼‰
cd ../frontend
flutter pub get
flutter run
```
